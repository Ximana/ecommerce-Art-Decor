{% extends 'administracao/base.html' %}
{% load static %}

{% block title %}Editar Método de Pagamento - PulmoVision{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Cabeçalho -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="text-success mb-0">
                <i class="fas fa-edit me-2"></i>Editar Método de Pagamento
            </h2>
            <p class="text-muted">Atualize as informações do método de pagamento</p>
        </div>
        <a href="{% url 'administracao:metodo_pagamento_lista' %}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Voltar para Lista
        </a>
    </div>

    <!-- Formulário de Edição -->
    <div class="card shadow-sm">
        <div class="card-body">
            <form class="row g-3" method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                
                <!-- Informações básicas -->
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="{{ form.nome.id_for_label }}">Nome do Método</label>
                        {{ form.nome }}
                        {% if form.nome.errors %}
                            <div class="invalid-feedback d-block">{{ form.nome.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="{{ form.tipo.id_for_label }}">Tipo de Pagamento</label>
                        {{ form.tipo }}
                        {% if form.tipo.errors %}
                            <div class="invalid-feedback d-block">{{ form.tipo.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Detalhes bancários -->
                <div class="col-md-6 bancario-field">
                    <div class="form-group mb-3">
                        <label for="{{ form.banco.id_for_label }}">Banco</label>
                        {{ form.banco }}
                        {% if form.banco.errors %}
                            <div class="invalid-feedback d-block">{{ form.banco.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.banco.help_text }}</small>
                    </div>
                </div>

                <div class="col-md-6 bancario-field">
                    <div class="form-group mb-3">
                        <label for="{{ form.titular_conta.id_for_label }}">Titular da Conta</label>
                        {{ form.titular_conta }}
                        {% if form.titular_conta.errors %}
                            <div class="invalid-feedback d-block">{{ form.titular_conta.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>

                <div class="col-md-6 bancario-field">
                    <div class="form-group mb-3">
                        <label for="{{ form.numero_conta.id_for_label }}">Número da Conta</label>
                        {{ form.numero_conta }}
                        {% if form.numero_conta.errors %}
                            <div class="invalid-feedback d-block">{{ form.numero_conta.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.numero_conta.help_text }}</small>
                    </div>
                </div>

                <div class="col-md-6 bancario-field">
                    <div class="form-group mb-3">
                        <label for="{{ form.iban.id_for_label }}">IBAN</label>
                        {{ form.iban }}
                        {% if form.iban.errors %}
                            <div class="invalid-feedback d-block">{{ form.iban.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.iban.help_text }}</small>
                    </div>
                </div>
                
                <!-- Taxas e valores -->
                <div class="col-md-3">
                    <div class="form-group mb-3">
                        <label for="{{ form.taxa.id_for_label }}">Taxa (%)</label>
                        {{ form.taxa }}
                        {% if form.taxa.errors %}
                            <div class="invalid-feedback d-block">{{ form.taxa.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.taxa.help_text }}</small>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="form-group mb-3">
                        <label for="{{ form.taxa_fixa.id_for_label }}">Taxa Fixa (AOA)</label>
                        {{ form.taxa_fixa }}
                        {% if form.taxa_fixa.errors %}
                            <div class="invalid-feedback d-block">{{ form.taxa_fixa.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.taxa_fixa.help_text }}</small>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="form-group mb-3">
                        <label for="{{ form.valor_minimo.id_for_label }}">Valor Mínimo (AOA)</label>
                        {{ form.valor_minimo }}
                        {% if form.valor_minimo.errors %}
                            <div class="invalid-feedback d-block">{{ form.valor_minimo.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.valor_minimo.help_text }}</small>
                    </div>
                </div>
                
                <div class="col-md-3">
                    <div class="form-group mb-3">
                        <label for="{{ form.valor_maximo.id_for_label }}">Valor Máximo (AOA)</label>
                        {{ form.valor_maximo }}
                        {% if form.valor_maximo.errors %}
                            <div class="invalid-feedback d-block">{{ form.valor_maximo.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.valor_maximo.help_text }}</small>
                    </div>
                </div>
                
                <!-- Processamento -->
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="{{ form.prazo_processamento.id_for_label }}">Prazo de Processamento (dias)</label>
                        {{ form.prazo_processamento }}
                        {% if form.prazo_processamento.errors %}
                            <div class="invalid-feedback d-block">{{ form.prazo_processamento.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="{{ form.ordem.id_for_label }}">Ordem de Exibição</label>
                        {{ form.ordem }}
                        {% if form.ordem.errors %}
                            <div class="invalid-feedback d-block">{{ form.ordem.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.ordem.help_text }}</small>
                    </div>
                </div>
                
                <!-- Descrições -->
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="{{ form.descricao.id_for_label }}">Descrição</label>
                        {{ form.descricao }}
                        {% if form.descricao.errors %}
                            <div class="invalid-feedback d-block">{{ form.descricao.errors|first }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="{{ form.instrucoes.id_for_label }}">Instruções de Pagamento</label>
                        {{ form.instrucoes }}
                        {% if form.instrucoes.errors %}
                            <div class="invalid-feedback d-block">{{ form.instrucoes.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.instrucoes.help_text }}</small>
                    </div>
                </div>
                
                <!-- Status e visibilidade -->
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <div class="form-check">
                            {{ form.status }}
                            <label class="form-check-label" for="{{ form.status.id_for_label }}">Método Ativo</label>
                            {% if form.status.errors %}
                                <div class="invalid-feedback d-block">{{ form.status.errors|first }}</div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <div class="form-check">
                            {{ form.mostrar_na_loja }}
                            <label class="form-check-label" for="{{ form.mostrar_na_loja.id_for_label }}">Mostrar na Loja</label>
                            {% if form.mostrar_na_loja.errors %}
                                <div class="invalid-feedback d-block">{{ form.mostrar_na_loja.errors|first }}</div>
                            {% endif %}
                            <small class="form-text text-muted d-block">{{ form.mostrar_na_loja.help_text }}</small>
                        </div>
                    </div>
                </div>
                
                <!-- Imagem -->
                <div class="col-md-12">
                    <div class="form-group mb-3">
                        <label for="{{ form.imagem.id_for_label }}">Imagem/Logo</label>
                        {% if form.instance.imagem %}
                            <div class="mb-2">
                                <img src="{{ form.instance.imagem.url }}" alt="Logo atual" style="max-height: 50px;">
                                <small class="text-muted ms-2">Imagem atual</small>
                            </div>
                        {% endif %}
                        {{ form.imagem }}
                        {% if form.imagem.errors %}
                            <div class="invalid-feedback d-block">{{ form.imagem.errors|first }}</div>
                        {% endif %}
                        <small class="form-text text-muted">{{ form.imagem.help_text }}</small>
                    </div>
                </div>

                <!-- Botões -->
                <div class="col-12 mt-4">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save me-2"></i>Salvar Alterações
                    </button>
                    <a href="{% url 'administracao:metodo_pagamento_lista' %}" class="btn btn-outline-secondary ms-2">
                        Cancelar
                    </a>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scriptJS %}
<script>
// Mostrar/esconder campos de acordo com o tipo de pagamento selecionado
document.addEventListener('DOMContentLoaded', function() {
    const tipoSelect = document.getElementById('{{ form.tipo.id_for_label }}');
    
    function toggleBancoFields() {
        const tipo = tipoSelect.value;
        const bancarioFields = document.querySelectorAll('.bancario-field');
        
        if (tipo === 'transferencia_bancaria' || tipo === 'referencia') {
            bancarioFields.forEach(field => {
                field.style.display = 'block';
            });
        } else {
            bancarioFields.forEach(field => {
                field.style.display = 'none';
            });
        }
    }
    
    tipoSelect.addEventListener('change', toggleBancoFields);
    
    // Executa na carga inicial
    toggleBancoFields();
});
</script>
{% endblock %}